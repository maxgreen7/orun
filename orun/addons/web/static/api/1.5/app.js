// Generated by CoffeeScript 1.10.0
(function() {
  var ngApp;

  ngApp = angular.module('katridApp', ['ngRoute', 'ngCookies', 'ngSanitize', 'ui-katrid']);

  ngApp.config(function($interpolateProvider) {
    $interpolateProvider.startSymbol('${');
    return $interpolateProvider.endSymbol('}');
  });

  ngApp.factory('actions', function() {
    return {
      get: function(id) {
        return $.get('/web/action/' + id + '/');
      }
    };
  });

  ngApp.config(function($routeProvider) {
    $routeProvider.when('/action/:actionId', {
      controller: 'ActionController',
      reloadOnSearch: false,
      resolve: {
        action: [
          'actions', '$route', function(actions, $route) {
            return actions.get($route.current.params.actionId);
          }
        ]
      },
      template: '<div id="katrid-action-view">Loading...</div>'
    });
  });

  ngApp.controller('ActionController', function($scope, $compile, action, $location) {
    var fnMain;
    $scope.data = null;
    $scope.record = null;
    $scope.recordIndex = null;
    $scope.records = null;
    $scope.viewType = null;
    $scope.recordCount = 0;
    $scope.$on('$routeUpdate', function() {
      return $scope.action.routeUpdate($location.$$search);
    });
    $scope.setContent = function(content) {
      $scope.content = content;
      return angular.element('#katrid-action-view').html($compile(content)($scope));
    };
    $scope.next = function() {
      return $scope.moveBy(1);
    };
    $scope.prior = function() {
      return $scope.moveBy(-1);
    };
    $scope.moveBy = function(index) {
      var newIndex;
      newIndex = $scope.recordIndex + index - 1;
      if (newIndex > -1 && newIndex < $scope.records.length) {
        $scope.recordIndex = newIndex + 1;
        return $location.search('id', $scope.records[newIndex].id);
      }
    };
    $scope.get = function(id) {
      return $scope.model.get(id).success(function(res) {
        return $scope.$apply(function() {
          $scope.record = res.result.data[0];
          return console.log($scope.record);
        });
      });
    };
    $scope.setRecordIndex = function(index) {
      return $scope.recordIndex = index + 1;
    };
    $scope.goto = function(index) {
      return $scope.moveBy(index - $scope.recordIndex);
    };
    $scope.hasKey = function(id) {
      var j, len, rec, ref, results;
      ref = $scope.records;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        rec = ref[j];
        if (rec.id === id) {
          results.push(true);
        } else {
          results.push(void 0);
        }
      }
      return results;
    };
    $scope.getIndex = function(obj) {
      var i, j, len, rec, ref, results;
      i = 0;
      ref = $scope.records;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        rec = ref[j];
        if (rec.id === obj) {
          i;
        }
        results.push(i++);
      }
      return results;
    };
    $scope.search = function(params) {
      return this.model.search(params, {
        count: 1
      }).success(function(res) {
        return $scope.$apply(function() {
          if (res.result.count != null) {
            $scope.recordCount = res.result.count;
          }
          return $scope.records = res.result.data;
        });
      });
    };
    fnMain = function(action) {
      var act;
      if (action) {
        $scope.model = new Katrid.Services.Model(action.model[1]);
        $scope.action = act = new Katrid.Actions[action.action_type](action, $scope, $location);
        return act.routeUpdate($location.$$search);
      }
    };
    return fnMain(action);
  });

  Katrid.ngApp = ngApp;

}).call(this);

//# sourceMappingURL=app.js.map
