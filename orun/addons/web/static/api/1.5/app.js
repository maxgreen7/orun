// Generated by CoffeeScript 1.10.0
(function() {
  var ngApp;

  ngApp = angular.module('katridApp', ['ngRoute', 'ngCookies', 'ngSanitize', 'ui-katrid']);

  ngApp.config(function($interpolateProvider) {
    $interpolateProvider.startSymbol('${');
    return $interpolateProvider.endSymbol('}');
  });

  ngApp.factory('actions', function() {
    return {
      get: function(service, id) {
        if (id) {
          return $.get("/web/action/" + service + "/" + id + "/");
        } else {
          return $.get("/web/action/" + service + "/");
        }
      }
    };
  });

  ngApp.config(function($routeProvider) {
    $routeProvider.when('/action/:actionId/', {
      controller: 'ActionController',
      reloadOnSearch: false,
      resolve: {
        action: [
          'actions', '$route', function(actions, $route) {
            return actions.get($route.current.params.actionId);
          }
        ]
      },
      template: "<div id=\"katrid-action-view\">" + (Katrid.i18n.gettext('Loading...')) + "</div>"
    }).when('/action/:service/:actionId/', {
      controller: 'ActionController',
      reloadOnSearch: false,
      resolve: {
        action: [
          'actions', '$route', function(actions, $route) {
            return actions.get($route.current.params.service, $route.current.params.actionId);
          }
        ]
      },
      template: "<div id=\"katrid-action-view\">" + (Katrid.i18n.gettext('Loading...')) + "</div>"
    });
  });

  ngApp.controller('BasicController', function($scope, $compile, $location) {
    $scope.compile = $compile;
    return $scope.Katrid = Katrid;
  });

  ngApp.controller('ActionController', function($scope, $compile, action, $location) {
    var init;
    $scope.Katrid = Katrid;
    $scope.data = null;
    $scope.location = $location;
    $scope.record = null;
    $scope.recordIndex = null;
    $scope.recordId = null;
    $scope.records = null;
    $scope.viewType = null;
    $scope.recordCount = 0;
    $scope.dataSource = new Katrid.Data.DataSource($scope);
    $scope.compile = $compile;
    $scope.$on('$routeUpdate', function() {
      return $scope.action.routeUpdate($location.$$search);
    });
    $scope.$set = function(field, value) {
      var control;
      control = $scope.form[field];
      control.$setViewValue(value);
      control.$render();
    };
    $scope.setContent = function(content) {
      var el;
      $scope.content = $(content);
      el = angular.element('#katrid-action-view').html($compile(content)($scope));
      $scope.formElement = el.find('form').first();
      return $scope.form = $scope.formElement.controller('form');
    };
    init = function(action) {
      var act;
      if (action) {
        $scope.model = new Katrid.Services.Model(action.model[1]);
        $scope.action = act = new Katrid.Actions[action.action_type](action, $scope);
        return act.routeUpdate($location.$$search);
      }
    };
    return init(action);
  });

  this.Katrid.ngApp = ngApp;

}).call(this);

//# sourceMappingURL=app.js.map
